from pwn import *
import base64

base = 0x8048000
proc = remote("", )


proc.recvuntil("Expected bytes: ")
data = proc.recvuntil("\n")
proc.recvuntil("Bytes? ")
proc.send(data)

for i in range(128):
    proc.recvuntil("ELF:  ")
    b64binary = proc.recvuntil("\n")
    b64binary = b64binary.strip()
    print(b64binary)
    
    binary = base64.b64decode(b64binary)
    
    entry = binary[0x18:0x18+4]
    entry = struct.unpack('<I', entry)[0]
    print(hex(entry))
    
    entry = entry - base
    size = binary[entry+3:entry+4]
    size = int.from_bytes(size, byteorder='big')
    print("size: " + str(size))
    
    addr = binary[entry+7:entry+11]
    addr = struct.unpack('<I', addr)[0]
    
    if addr > 0xFFFF:
        addr = addr - (1 << 32)
        addr = (entry+0xB) + addr
    else:
        addr = (entry+0xB) + addr
    print("addr2 : " + str(addr))
    
    data = binary[addr:addr+size]
    data = data.hex()
    
    proc.recvuntil("Bytes?")
    proc.sendline(data)
proc.interactive()

